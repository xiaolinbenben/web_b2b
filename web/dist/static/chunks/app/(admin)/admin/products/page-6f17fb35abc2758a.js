(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7578],{20969:function(e,t,l){Promise.resolve().then(l.bind(l,78036))},78036:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return z}});var a=l(57437),s=l(2265),i=l(27648),r=l(93142),n=l(27502),o=l(54534),d=l(48651),c=l(79525),p=l(11679),x=l(44434),u=l(56771),h=l(30245),m=l(7065),g=l(16836),j=l(98280),f=l(93834),v=l(23496),y=l(12701),w=l(96257),Z=l(89076),C=l(35831),N=l(30166);let S=s.forwardRef((e,t)=>{let{properties:l,handlePropertyChange:i}=e,[r,n]=(0,s.useState)([]);(0,s.useEffect)(()=>{l&&l.length>0?n(JSON.parse(l)):n([])},[l]);let o=(e,t,l)=>{let a=[...r];a[e][t]=l,n(a),i(a)},d=()=>{for(let e of r)if(!e.name||!e.value)return!1;return!0};(0,s.useImperativeHandle)(t,()=>({handleCheckSubmit:d}));let p=e=>{let t=r.filter((t,l)=>l!==e);n(t),i(t)};return(0,a.jsxs)("div",{children:[(0,a.jsx)("ul",{children:null==r?void 0:r.map((e,t)=>(0,a.jsxs)("li",{style:{marginBottom:"16px"},children:[(0,a.jsx)(g.Z,{type:"text",placeholder:"属性名",style:{width:"200px"},value:e.name,onChange:e=>o(t,"name",e.target.value)})," \xa0 : \xa0",(0,a.jsx)(g.Z,{type:"text",placeholder:"属性值",style:{width:"200px"},value:e.value,onChange:e=>o(t,"value",e.target.value)}),(0,a.jsx)("a",{className:"text-adminPrimaryColor",onClick:()=>p(t),style:{width:"80px",lineHeight:"32px",textAlign:"center",marginLeft:"16px"},children:"删除"})]},t))}),(0,a.jsx)(c.ZP,{onClick:()=>{n([...r,{name:"",value:""}])},children:"添加属性"})]})});S.displayName="PropertyPanel";let k=l(61994).Z.Group,b=(0,N.default)(()=>Promise.all([l.e(9766),l.e(4070),l.e(7320)]).then(l.bind(l,57320)),{loadableGenerated:{webpack:()=>[57320]},ssr:!1});var P=e=>{let{isOpen:t,onRequestClose:l,initialItem:i}=e,[r,n]=(0,s.useState)(i||{}),[d,p]=(0,s.useState)(!1),x=s.useRef(null),[u,N]=(0,s.useState)([]),[P,_]=(0,s.useState)([]),I=(0,s.useRef)(null),[E,O]=(0,s.useState)([]),R=(e,t)=>{O(t);let l=t.join(",");n(t=>({...t,[e]:l}))},T=async()=>{try{let{code:e,msg:t,data:l}=await h.Z.get("/myapp/admin/category/list");0===e?N(l):o.ZP.error(t||"网络异常")}catch(e){}};(0,s.useEffect)(()=>{let e=setTimeout(()=>{var e,t,l,a;(null==i?void 0:null===(e=i.cover)||void 0===e?void 0:e.length)>0?_(null==i?void 0:null===(l=i.cover)||void 0===l?void 0:l.split("#").map(e=>({success:!0,name:e,status:"done",url:"https://shop.beisi.tech/upload/img/"+e}))):_([]),(null==i?void 0:null===(t=i.dimension)||void 0===t?void 0:t.length)>0?O(null==i?void 0:null===(a=i.dimension)||void 0===a?void 0:a.split(",")):O([]),n(i||{}),x.current&&(x.current.scrollTop=0),T()},100);return()=>{clearTimeout(e)}},[i]);let L=()=>{z()},z=async()=>{if(!r.title){o.ZP.error("请输入名称");return}if(!r.category){o.ZP.error("请选择分类");return}if(!r.cover){o.ZP.error("请上传图片");return}if(!I.current.handleCheckSubmit()){o.ZP.error("参数不能留空");return}try{p(!0);let e=r.id?"/myapp/admin/thing/update":"/myapp/admin/thing/create",t=new FormData;r.id&&t.append("id",r.id),t.append("title",r.title||""),t.append("category",r.category),t.append("summary",r.summary||""),t.append("price",r.price||""),t.append("dimension",r.dimension||""),t.append("cover",r.cover||""),t.append("description",r.description||""),t.append("seo_title",r.seo_title||""),t.append("seo_description",r.seo_description||""),t.append("seo_keywords",r.seo_keywords||""),t.append("properties",r.properties||""),t.append("status",r.status||"0");let{code:a,msg:s,data:i}=await h.Z.post(e,t);0===a?(o.ZP.success("操作成功"),l(!0)):o.ZP.error(s||"网络异常"),p(!1)}catch(e){p(!1)}},q=(e,t)=>{n(l=>({...l,[e]:t}))},F=(e,t)=>{n(l=>({...l,[e]:t}))},W=(e,t)=>{n(l=>({...l,[e]:t}))};return(0,a.jsx)(m.Z,{title:r.id?"编辑":"新增",centered:!0,open:t,onCancel:()=>l(!1),footer:null,width:1100,styles:{mask:{backdropFilter:"blur(10px)"}},children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{ref:x,className:"max-h-[75vh] overflow-y-auto",children:[(0,a.jsx)(y.Z,{title:"基本信息"}),(0,a.jsxs)("div",{className:"flex flex-col gap-6 px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"名称",required:!0}),(0,a.jsx)(g.Z,{placeholder:"请输入产品名称",value:r.title,onChange:e=>q("title",e.target.value),maxLength:100,style:{width:300}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"分类",required:!0}),(0,a.jsx)(j.Z,{dropdownStyle:{maxHeight:300,overflow:"auto",minWidth:300},style:{width:300},placeholder:"请选择",value:r.category,placement:"bottomLeft",allowClear:!0,fieldNames:{label:"title",value:"id",children:"children"},onChange:e=>W("category",e),treeData:u})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,a.jsx)(w.Z,{title:"产品维度"}),(0,a.jsx)(k,{options:[{label:"推荐",value:"Recommend"},{label:"精选",value:"Feature"}],value:E,onChange:e=>R("dimension",e)})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,a.jsx)(w.Z,{title:"价格"}),(0,a.jsx)(g.Z,{placeholder:"选填",value:r.price,onChange:e=>q("price",e.target.value),style:{width:300}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"摘要",required:!0}),(0,a.jsx)(C.Z,{placeholder:"请输入产品摘要",autoSize:{minRows:3,maxRows:6},showCount:!0,maxLength:500,value:r.summary,onChange:e=>q("summary",e.target.value),style:{width:600}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4 min-h-[100px]",children:[(0,a.jsx)(w.Z,{title:"图片",required:!0}),(0,a.jsx)(Z.Z,{maxCount:5,maxSize:5,accept:"image/*",imageList:P,onImageUploadChange:e=>{let t=e&&e.length>0?e.join("#"):null;n(e=>({...e,cover:t}))}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"是否启用"}),(0,a.jsx)(f.Z,{defaultValue:"0",placeholder:"请选择状态",value:r.status,style:{width:400},onChange:e=>F("status",e),options:[{value:"0",label:"是"},{value:"1",label:"否"}]})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsx)(y.Z,{title:"产品详情"}),(0,a.jsx)("div",{className:"flex flex-col gap-4 px-2 py-2",children:(0,a.jsx)(b,{htmlText:r.description,onHtmlResult:e=>{n(t=>({...t,description:e}))}})}),(0,a.jsx)(v.Z,{}),(0,a.jsx)(y.Z,{title:"产品参数"}),(0,a.jsx)("div",{className:"flex flex-col gap-4 px-2 py-2",children:(0,a.jsx)(S,{ref:I,properties:r.properties,handlePropertyChange:e=>{n(t=>({...t,properties:JSON.stringify(e||[])}))}})}),(0,a.jsx)(v.Z,{}),(0,a.jsx)(y.Z,{title:"SEO优化"}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 px-2 py-2",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"SEO标题"}),(0,a.jsx)(g.Z,{placeholder:"请输入SEO标题",value:r.seo_title,onChange:e=>q("seo_title",e.target.value),style:{width:600}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"SEO关键词"}),(0,a.jsx)(g.Z,{placeholder:"请输入SEO关键词",value:r.seo_keywords,onChange:e=>q("seo_keywords",e.target.value),style:{width:600}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"SEO描述"}),(0,a.jsx)(C.Z,{placeholder:"请输入SEO描述",autoSize:{minRows:3,maxRows:6},showCount:!0,maxLength:200,value:r.seo_description,onChange:e=>q("seo_description",e.target.value),style:{width:600}})]})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(c.ZP,{loading:d,type:"primary",onClick:()=>L(),children:"提交"}),(0,a.jsx)(c.ZP,{onClick:()=>l(!1),children:"取消"})]})]})})})},_=l(99376);function I(){(0,_.useRouter)();let[e,t]=(0,s.useState)(!1),[l,m]=(0,s.useState)([]),[g,j]=(0,s.useState)(!1),[f,v]=(0,s.useState)(null),[y,w]=(0,s.useState)([]),[Z,C]=(0,s.useState)(""),[N,S]=(0,s.useState)(1),[k,b]=(0,s.useState)(10),[I,E]=(0,s.useState)(0),O=e=>{j(!0),v(e)},R=async e=>{try{let{code:t,data:a}=await h.Z.post("/myapp/admin/thing/delete",{ids:e.join(",")});0===t?(o.ZP.success("删除成功"),e.length===l.length&&N>1?S(N-1):T(N,k)):o.ZP.error("删除失败")}catch(e){}},T=async(e,l)=>{try{t(!0);let{code:a,total:s,data:i}=await h.Z.get("/myapp/admin/thing/list",{params:{page:e,pageSize:l,keyword:Z}});0===a?(m(i),E(s),S(e),b(l)):o.ZP.error("数据获取失败"),t(!1)}catch(e){o.ZP.error("网络异常"),t(!1)}};return(0,s.useEffect)(()=>{T(N,k)},[N,Z]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{spinning:e,tip:"",children:(0,a.jsxs)("div",{className:"bg-white px-4 py-4 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(c.ZP,{type:"primary",onClick:()=>O({status:"0"}),children:"新增产品"}),(0,a.jsx)(n.Z,{title:"确定删除？",okText:"确定",cancelText:"取消",onConfirm:()=>R(y),children:(0,a.jsx)(c.ZP,{disabled:!y.length>0,children:"删除"})}),(0,a.jsx)(u.Z,{placeholder:"搜索产品",allowClear:!0,onSearch:(e,t,l)=>{S(1),C(e||"")},style:{width:200,marginLeft:"auto"}})]}),(0,a.jsxs)("div",{className:"bg-white",children:[(0,a.jsx)(p.Z,{columns:[{title:"产品名称",dataIndex:"title",key:"title",width:"200px",textWrap:"word-break",ellipsis:!0},{title:"分类",dataIndex:"category_title",key:"category_title",width:"150px",textWrap:"word-break",ellipsis:!0},{title:"摘要",dataIndex:"summary",key:"summary",width:"280px",textWrap:"word-break",ellipsis:!0},{title:"是否启用",dataIndex:"status",key:"status",width:"90px",textWrap:"word-break",ellipsis:!0,render:e=>(0,a.jsx)("div",{children:"0"===e?"是":"否"})},{title:"创建时间",dataIndex:"create_time",key:"create_time",width:"150px",textWrap:"word-break",ellipsis:!0},{title:"操作",key:"action",fixed:"right",align:"center",width:"150px",textWrap:"word-break",ellipsis:!0,render:(e,t)=>(0,a.jsxs)(r.Z,{size:"middle",children:[(0,a.jsx)("a",{className:"text-adminPrimaryColor",onClick:()=>O(t),children:"编辑"}),(0,a.jsx)(n.Z,{title:"确定删除？",okText:"确定",cancelText:"取消",onConfirm:()=>R([t.id]),children:(0,a.jsx)("a",{className:"text-adminPrimaryColor",children:"删除"})}),(0,a.jsx)(i.default,{className:"text-adminPrimaryColor",href:"/product/".concat(t.id),target:"_blank",rel:"noopener noreferrer",children:"预览"})]})}],dataSource:l,size:"middle",rowSelection:{selectedRowKeys:y,onChange:e=>{w(e)}},rowKey:e=>e.id,pagination:!1,showSizeChanger:!1}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(x.Z,{align:"end",current:N,pageSize:k,total:I,showTotal:e=>"共 ".concat(e," 条"),onChange:(e,t)=>{S(e),b(t)}})})]})]})}),(0,a.jsx)(P,{isOpen:g,onRequestClose:e=>{j(!1),v(null),e&&T(N,k)},initialItem:f})]})}var E=l(34755),O=l(68575),R=l(90136),T=e=>{let{isOpen:t,onRequestClose:l,initialItem:i}=e,[r,n]=(0,s.useState)(i||{}),[p,x]=(0,s.useState)([]),[u,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{var e,t;n(i||{}),(null==i?void 0:null===(e=i.cover)||void 0===e?void 0:e.length)>0?x(null==i?void 0:null===(t=i.cover)||void 0===t?void 0:t.split("#").map(e=>({success:!0,name:e,status:"done",url:"https://shop.beisi.tech/upload/img/"+e}))):x([])},[i]);let f=(e,t)=>{n(l=>({...l,[e]:t}))},y=async()=>{if(!r.title){o.ZP.error("请输入分类名称");return}if(!r.cover){o.ZP.error("请上传封面图");return}try{j(!0);let e=r.id?"/myapp/admin/category/update":"/myapp/admin/category/create",t=new FormData;r.id&&t.append("id",r.id),r.cover&&t.append("cover",r.cover),t.append("pid",r.pid),t.append("title",r.title||""),t.append("sort",r.sort||0);let{code:a,msg:s,data:i}=await h.Z.post(e,t);0===a?(o.ZP.success("操作成功"),l(!0)):o.ZP.error(s||"网络异常"),j(!1)}catch(e){j(!1)}};return(0,a.jsx)(m.Z,{title:r.id?"编辑分类":"新增分类",centered:!0,open:t,onCancel:()=>l(!1),footer:null,width:600,children:(0,a.jsx)(d.Z,{spinning:u,tip:"",children:(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)("div",{className:"",children:(0,a.jsxs)("div",{className:"",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 pt-4 pb-0 overflow-y-auto max-h-[70vh]",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"分类名称",required:!0}),(0,a.jsx)(g.Z,{placeholder:"请输入分类名称",value:r.title,onChange:e=>f("title",e.target.value),style:{width:400}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"封面图",required:!0}),(0,a.jsx)(Z.Z,{maxCount:1,maxSize:2,accept:"image/*",imageList:p,onImageUploadChange:e=>{let t=e&&e.length>0?e.join("#"):null;n(e=>({...e,cover:t}))}})]}),(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)(w.Z,{title:"排序",required:!0}),(0,a.jsx)(R.Z,{placeholder:"请输入顺序号",value:r.sort,onChange:e=>f("sort",e),style:{width:400}})]})]}),(0,a.jsx)(v.Z,{}),(0,a.jsxs)("div",{className:"flex flex-row gap-4 justify-start",children:[(0,a.jsx)(c.ZP,{type:"primary",onClick:y,children:"提交"}),(0,a.jsx)(c.ZP,{onClick:()=>l(!1),children:"取消"})]})]})})})})})};function L(){(0,O.v9)(e=>e.adminSetting),(0,O.I0)();let[e,t]=(0,s.useState)(!1),l=async()=>{try{t(!0);let{code:e,data:l}=await h.Z.get("/myapp/admin/category/list");0===e?x(l):o.ZP.error("数据获取失败"),t(!1)}catch(e){}};(0,s.useEffect)(()=>{l()},[]);let[i,x]=(0,s.useState)([]),[u,m]=(0,s.useState)(!1),[g,j]=(0,s.useState)(null),f=e=>{m(!0),j(e)},v=async e=>{try{let{code:t,data:a}=await h.Z.post("/myapp/admin/category/delete",{id:e.id});0===t?(o.ZP.success("删除成功"),l()):o.ZP.error("删除失败")}catch(e){}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{spinning:e,tip:"",children:(0,a.jsxs)("div",{className:"bg-white px-4 py-4 flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex flex-row gap-4",children:(0,a.jsx)(c.ZP,{type:"primary",onClick:()=>f({sort:0,pid:-1}),children:"新增分类"})}),(0,a.jsx)(p.Z,{columns:[{title:"分类名称",dataIndex:"title",key:"title"},{title:"排序",dataIndex:"sort",key:"sort"},{title:"操作",key:"action",align:"left",width:"260px",render:(e,t)=>(0,a.jsxs)(r.Z,{size:"middle",children:[(0,a.jsx)("a",{className:"text-adminPrimaryColor",onClick:()=>f(t),children:"编辑"}),-1===t.pid?(0,a.jsx)("a",{className:"text-adminPrimaryColor",onClick:()=>f({sort:0,pid:t.id}),children:"添加子分类"}):null,(0,a.jsx)(n.Z,{title:"确定删除？",okText:"确定",cancelText:"取消",onConfirm:()=>v(t),children:(0,a.jsx)("a",{className:"text-adminPrimaryColor",children:"删除"})})]})}],dataSource:i,size:"middle",rowKey:e=>e.id,pagination:!1})]})}),(0,a.jsx)(T,{isOpen:u,onRequestClose:e=>{m(!1),j(null),e&&l()},initialItem:g})]})}function z(){(0,s.useEffect)(()=>{},[]);let e=[{key:"1",label:"产品列表",children:(0,a.jsx)(I,{})},{key:"2",label:"产品分类",children:(0,a.jsx)(L,{})}];return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"bg-gray-100 px-4 py-4",children:(0,a.jsx)("div",{className:"",children:(0,a.jsx)(E.Z,{indicator:{size:e=>24,align:"center"},tabBarStyle:{paddingLeft:"20px",outline:"none",fontWeight:"400"},className:"bg-white custom-tab",defaultActiveKey:"1",items:e,onChange:e=>{}})})})})}},96257:function(e,t,l){"use strict";var a=l(57437);l(2265),t.Z=e=>{let{title:t,required:l,labelWidth:s=80}=e;return(0,a.jsxs)("span",{className:"text-[14px] text-[#777] h-[30px] leading-[30px] flex flex-row items-center",style:{width:"".concat(s,"px")},children:[(0,a.jsxs)("div",{children:[t," "]}),(0,a.jsx)("div",{className:"flex flex-col items-center mx-1",children:l?(0,a.jsx)("span",{className:"text-red-500 font-bold text-[14px] ",children:"*"}):null})]})}},89076:function(e,t,l){"use strict";var a=l(57437),s=l(2265),i=l(96473),r=l(54534),n=l(51145),o=l(66789);let d=e=>new Promise((t,l)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result),a.onerror=e=>l(e)});t.Z=e=>{let{maxCount:t,maxSize:l,accept:c,imageList:p,onImageUploadChange:x}=e,[u,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(""),[j,f]=(0,s.useState)(p),[v,y]=(0,s.useState)("");(0,s.useEffect)(()=>{f(p),localStorage.getItem("admintoken")&&y(localStorage.getItem("admintoken"))},[p]);let w=async e=>{e.url||e.preview||(e.preview=await d(e.originFileObj)),g(e.url||e.preview),h(!0)},Z=(0,a.jsxs)("button",{style:{border:0,background:"none",display:"flex",alignItems:"center"},type:"button",children:[(0,a.jsx)(i.Z,{}),(0,a.jsx)("div",{style:{marginTop:8}})]});return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:" min-h-[102px]",children:[(0,a.jsx)(n.Z,{accept:c,listType:"picture-card",fileList:j,onPreview:w,onChange:e=>{let{file:t,fileList:l}=e;f(l),"error"===t.status&&r.ZP.error("上传失败");let a=[];l.forEach(e=>{e.success&&a.push(e.name),e.response&&(0===e.response.code?a.push(e.response.data):1===e.response.code&&(r.ZP.error("上传失败："+e.response.msg),e.status="error"))}),x(a)},maxCount:t,name:"my-file",action:"https://shop.beisi.tech/myapp/admin/cdn/uploadImg",headers:{admintoken:v},children:(null==j?void 0:j.length)>=t?null:Z}),m&&(0,a.jsx)(o.Z,{wrapperStyle:{display:"none"},preview:{visible:u,onVisibleChange:e=>h(e),afterOpenChange:e=>!e&&g("")},src:m})]}),(0,a.jsxs)("div",{className:"text-gray-400 text-sm",children:["图片大小",l,"MB以内，最多",t,"张图片"]})]})})}},12701:function(e,t,l){"use strict";var a=l(57437);l(2265),t.Z=e=>{let{title:t}=e;return(0,a.jsx)("div",{className:"font-bold text-[14px] px-2 my-2",children:t})}},30245:function(e,t,l){"use strict";var a=l(83464);let s="https://shop.beisi.tech".replace(/\/$/,""),i=a.Z.create({baseURL:s||void 0,timeout:15e3,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{{let t=localStorage.getItem("admintoken");e.headers.ADMINTOKEN=t||""}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e.data,e=>{let{response:t}=e;return t?((401===t.status||403===t.status)&&(localStorage.removeItem("admintoken"),localStorage.removeItem("username"),window.location.href="/adminLogin"),Promise.reject(t.data)):Promise.reject(e)}),t.Z=i}},function(e){e.O(0,[2972,3718,3464,2601,6382,4534,114,5821,1102,8575,8696,6836,3705,6399,2631,3736,1581,293,404,2971,2117,1744],function(){return e(e.s=20969)}),_N_E=e.O()}]);