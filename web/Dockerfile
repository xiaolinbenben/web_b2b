FROM node:20-alpine AS runner
WORKDIR /app

ENV NODE_ENV=production
ENV NEXT_TELEMETRY_DISABLED=1
ENV PORT=80

ARG NEXT_PUBLIC_BASE_URL
ARG NEXT_PUBLIC_DJANGO_BASE_URL
ARG NEXT_PUBLIC_BASE_PATH
ARG NEXT_PUBLIC_IMAGE_DOMAINS
ARG NEXT_PUBLIC_TEMPLATE_ID
ENV NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL}
ENV NEXT_PUBLIC_DJANGO_BASE_URL=${NEXT_PUBLIC_DJANGO_BASE_URL}
ENV NEXT_PUBLIC_BASE_PATH=${NEXT_PUBLIC_BASE_PATH}
ENV NEXT_PUBLIC_IMAGE_DOMAINS=${NEXT_PUBLIC_IMAGE_DOMAINS}
ENV NEXT_PUBLIC_TEMPLATE_ID=${NEXT_PUBLIC_TEMPLATE_ID}

COPY dist/standalone ./.next/standalone
COPY dist/static ./.next/static
COPY public ./public

EXPOSE 80
CMD ["node", ".next/standalone/server.js"]
